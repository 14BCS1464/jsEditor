<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>React Online Editor üöÄ</title>

<!-- React & Babel -->
<script src="https://unpkg.com/@babel/standalone@7.23.5/babel.min.js"></script>
<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

<!-- Monaco Editor -->
<script src="https://unpkg.com/monaco-editor@0.45.0/min/vs/loader.js"></script>

<style>
/* ==================== CSS VARIABLES ==================== */
:root {
  --bg-primary: #0a0e27;
  --bg-secondary: #020308;
  --bg-tertiary: #1a1d2e;
  --glass-bg: rgba(255, 255, 255, 0.05);
  --glass-border: rgba(97, 218, 251, 0.2);
  --accent-blue: #61dafb;
  --accent-blue-dark: #21a1c4;
  --accent-purple: #8b5cf6;
  --accent-green: #10b981;
  --accent-red: #ef4444;
  --accent-yellow: #fbbf24;
  --text-primary: #e5e7eb;
  --text-secondary: #9ca3af;
  --text-tertiary: #6b7280;
  --border-color: rgba(97, 218, 251, 0.15);
  --console-bg: rgba(0, 0, 0, 0.4);
  --shadow-lg: 0 20px 60px rgba(0, 0, 0, 0.3);
  --shadow-md: 0 8px 32px rgba(0, 0, 0, 0.2);
  --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.1);
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
  background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
  color: var(--text-primary);
  height: 100vh;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

/* Animated background */
body::before {
  content: "";
  position: fixed;
  width: 200%;
  height: 200%;
  background: 
    radial-gradient(circle at 20% 50%, rgba(97, 218, 251, 0.15) 0%, transparent 50%),
    radial-gradient(circle at 80% 80%, rgba(139, 92, 246, 0.15) 0%, transparent 50%);
  animation: bgFloat 20s ease-in-out infinite alternate;
  pointer-events: none;
  z-index: -1;
}

@keyframes bgFloat {
  0%, 100% { transform: translate(0, 0) scale(1); }
  33% { transform: translate(30px, -30px) scale(1.05); }
  66% { transform: translate(-20px, 20px) scale(0.95); }
}

/* ==================== HEADER ==================== */
header {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 24px;
  backdrop-filter: blur(20px);
  background: rgba(255, 255, 255, 0.03);
  border-bottom: 1px solid var(--border-color);
  box-shadow: var(--shadow-md);
  z-index: 100;
}

.logo {
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: 20px;
  font-weight: 700;
  color: var(--accent-blue);
  cursor: default;
  user-select: none;
}

.logo::before {
  content: "‚öõÔ∏è";
  font-size: 28px;
  animation: spinLogo 15s linear infinite;
  filter: drop-shadow(0 0 8px rgba(97, 218, 251, 0.5));
}

@keyframes spinLogo {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

.controls {
  display: flex;
  gap: 10px;
  align-items: center;
}

/* ==================== BUTTONS ==================== */
button {
  position: relative;
  padding: 10px 20px;
  border-radius: 10px;
  border: none;
  font-weight: 600;
  font-size: 14px;
  cursor: pointer;
  background: linear-gradient(135deg, var(--accent-blue), var(--accent-blue-dark));
  color: var(--bg-secondary);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  overflow: hidden;
  box-shadow: var(--shadow-sm);
  display: flex;
  align-items: center;
  gap: 8px;
  letter-spacing: 0.3px;
}

button::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
  transition: 0.5s;
}

button:hover::before {
  left: 100%;
}

button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(97, 218, 251, 0.4);
}

button:active {
  transform: scale(0.96);
}

button.secondary {
  background: rgba(255, 255, 255, 0.08);
  border: 1px solid var(--border-color);
  color: var(--text-primary);
  box-shadow: none;
  backdrop-filter: blur(10px);
}

button.secondary:hover {
  background: rgba(255, 255, 255, 0.12);
  border-color: var(--accent-blue);
  transform: translateY(-2px);
}

/* ==================== LAYOUT ==================== */
.container {
  position: relative;
  flex: 1;
  display: flex;
  z-index: 1;
  overflow: hidden;
}

.editor-panel,
.preview-panel {
  flex: 1;
  display: flex;
  flex-direction: column;
  background: rgba(10, 14, 39, 0.7);
  backdrop-filter: blur(10px);
  position: relative;
  overflow: hidden;
}

.editor-panel {
  border-right: 1px solid var(--border-color);
}

/* ==================== PANEL HEADERS ==================== */
.panel-header {
  padding: 14px 20px;
  font-size: 13px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 1px;
  background: rgba(97, 218, 251, 0.1);
  border-bottom: 1px solid var(--border-color);
  display: flex;
  align-items: center;
  justify-content: space-between;
  color: var(--accent-blue);
  position: relative;
  overflow: hidden;
}

.panel-header::before {
  content: "‚óè";
  margin-right: 8px;
  animation: pulse 2s ease-in-out infinite;
  filter: drop-shadow(0 0 4px var(--accent-blue));
}

@keyframes pulse {
  0%, 100% { opacity: 0.6; }
  50% { opacity: 1; }
}

/* ==================== EDITOR CONTAINER ==================== */
#editor {
  flex: 1;
  width: 100%;
  height: 100%;
}

/* ==================== PREVIEW IFRAME ==================== */
#preview {
  flex: 1;
  width: 100%;
  border: none;
  background: white;
  transition: opacity 0.3s;
}

/* ==================== CONSOLE ==================== */
.console-container {
  height: 200px;
  border-top: 1px solid var(--border-color);
  display: flex;
  flex-direction: column;
  background: var(--console-bg);
  backdrop-filter: blur(10px);
}

.console-header {
  padding: 10px 16px;
  font-size: 12px;
  font-weight: 600;
  background: rgba(0, 0, 0, 0.3);
  border-bottom: 1px solid var(--border-color);
  display: flex;
  justify-content: space-between;
  align-items: center;
  color: var(--text-secondary);
}

.clear-btn {
  padding: 4px 12px;
  font-size: 11px;
  background: rgba(255, 255, 255, 0.08);
  border: 1px solid var(--border-color);
  color: var(--text-secondary);
  border-radius: 4px;
  transition: all 0.2s;
}

.clear-btn:hover {
  background: rgba(255, 255, 255, 0.12);
  color: var(--text-primary);
}

/* Console output */
#console {
  flex: 1;
  overflow-y: auto;
  padding: 14px;
  font-family: 'Cascadia Code', 'Consolas', 'JetBrains Mono', monospace;
  font-size: 13px;
  line-height: 1.6;
  color: #a0aec0;
  white-space: pre-wrap;
  background: rgba(0, 0, 0, 0.2);
}

#console::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

#console::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.02);
  border-radius: 4px;
}

#console::-webkit-scrollbar-thumb {
  background: rgba(97, 218, 251, 0.3);
  border-radius: 4px;
}

#console::-webkit-scrollbar-thumb:hover {
  background: rgba(97, 218, 251, 0.5);
}

/* Console line colors */
.console-line {
  margin-bottom: 4px;
  padding-left: 4px;
  border-left: 2px solid transparent;
}

.console-line.log {
  border-left-color: var(--accent-blue);
  color: #90cdf4;
}

.console-line.error {
  border-left-color: var(--accent-red);
  color: #fca5a5;
}

.console-line.warn {
  border-left-color: var(--accent-yellow);
  color: #fde68a;
}

.console-line.info {
  border-left-color: var(--accent-green);
  color: #a7f3d0;
}

/* ==================== ERROR DISPLAY ==================== */
#error {
  display: none;
  padding: 14px 18px;
  background: rgba(239, 68, 68, 0.1);
  border-left: 4px solid var(--accent-red);
  color: #fca5a5;
  font-family: 'Cascadia Code', 'Consolas', monospace;
  font-size: 13px;
  margin: 10px;
  border-radius: 8px;
  animation: slideIn 0.3s ease;
  backdrop-filter: blur(10px);
  box-shadow: var(--shadow-sm);
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateX(-10px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

/* ==================== STATUS BAR ==================== */
.status-bar {
  padding: 10px 18px;
  font-size: 12px;
  background: rgba(0, 0, 0, 0.4);
  border-top: 1px solid var(--border-color);
  display: flex;
  justify-content: space-between;
  align-items: center;
  backdrop-filter: blur(10px);
  position: relative;
  overflow: hidden;
}

.status-bar::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 1px;
  background: linear-gradient(90deg, transparent, var(--accent-blue), transparent);
}

.status-item {
  display: flex;
  align-items: center;
  gap: 8px;
  color: var(--text-secondary);
  transition: color 0.3s;
}

.status-item.ready {
  color: var(--accent-green);
}

.status-item.running {
  color: var(--accent-yellow);
  animation: pulseColor 1.5s infinite;
}

.status-item.error {
  color: var(--accent-red);
}

.status-item.typing {
  color: var(--accent-purple);
}

@keyframes pulseColor {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.6; }
}

/* ==================== RESPONSIVE DESIGN ==================== */
@media (max-width: 1024px) {
  .container {
    flex-direction: column;
  }
  
  .editor-panel,
  .preview-panel {
    min-height: 50vh;
  }
  
  .editor-panel {
    border-right: none;
    border-bottom: 1px solid var(--border-color);
  }
  
  .console-container {
    height: 180px;
  }
}

@media (max-width: 768px) {
  header {
    padding: 12px 16px;
    flex-direction: column;
    gap: 12px;
  }
  
  .controls {
    width: 100%;
    justify-content: center;
    flex-wrap: wrap;
  }
  
  button {
    padding: 8px 16px;
    font-size: 13px;
  }
  
  .logo {
    font-size: 18px;
  }
  
  .console-container {
    height: 150px;
  }
  
  .status-bar {
    padding: 8px 12px;
    font-size: 11px;
  }
}

@media (max-width: 480px) {
  .panel-header {
    padding: 12px 16px;
    font-size: 12px;
  }
  
  #console {
    font-size: 12px;
    padding: 12px;
  }
  
  button {
    padding: 6px 12px;
    font-size: 12px;
  }
}

/* ==================== CUSTOM SCROLLBARS ==================== */
::-webkit-scrollbar {
  width: 10px;
  height: 10px;
}

::-webkit-scrollbar-track {
  background: rgba(0, 0, 0, 0.2);
  border-radius: 5px;
}

::-webkit-scrollbar-thumb {
  background: rgba(97, 218, 251, 0.3);
  border-radius: 5px;
  border: 2px solid transparent;
  background-clip: padding-box;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(97, 218, 251, 0.5);
}

::-webkit-scrollbar-corner {
  background: transparent;
}

/* Editor error styling */
.error-line {
  background-color: rgba(239, 68, 68, 0.1) !important;
  border-left: 2px solid #ef4444 !important;
}

.error-glyph {
  background-color: #ef4444 !important;
  width: 4px !important;
  margin-left: 3px !important;
}
</style>
</head>

<body>

<header>
  <div class="logo">
    <span>React Online Editor</span>
  </div>
  <div class="controls">
    <button onclick="run()">‚ñ∂Ô∏è Run</button>
    <button class="secondary" onclick="share()">üîó Share</button>
    <button class="secondary" onclick="resetCode()">üîÑ Reset</button>
    <button class="secondary" onclick="formatCode()">‚ú® Format</button>
  </div>
</header>

<div class="container">
  <div class="editor-panel">
    <div class="panel-header">üìù Editor - App.tsx</div>
    <div id="editor"></div>
  </div>

  <div class="preview-panel">
    <div class="panel-header">üëÅÔ∏è Live Preview</div>
    <iframe id="preview" sandbox="allow-scripts allow-same-origin"></iframe>
    
    <div class="console-container">
      <div class="console-header">
        <span>üíª Console</span>
        <button class="clear-btn" onclick="clearConsole()">Clear</button>
      </div>
      <div id="error"></div>
      <div id="console">> Ready to run your React code...</div>
    </div>
  </div>
</div>

<div class="status-bar">
  <div class="status-item">
    <span>TypeScript</span>
    <span>‚Ä¢</span>
    <span>React 18</span>
  </div>
  <div id="status-indicator" class="status-item ready">
    <span>‚óè Ready</span>
  </div>
</div>


<script>
    /* ==================== INITIAL CODE ==================== */
    const defaultCode = `import React from "react";
    
   function App() {
      const [count, setCount] = React.useState(0);
      const [text, setText] = React.useState("");
    
      return (
        <div style={{ padding: 20 }}>
         
          
          <div style={{ 
            backgroundColor: '#f7fafc', 
            padding: 20, 
            borderRadius: 12,
            marginTop: 20 
          }}>
            <h2 style={{ color: '#2d3748' }}>Counter Demo</h2>
            <p style={{ fontSize: 24, color: '#4a5568' }}>
              Count: {count}
            </p>
            <button 
              onClick={() => setCount(c => c + 1)}
              style={{
                backgroundColor: '#61dafb',
                color: '#0a0e27',
                border: 'none',
                padding: '10px 20px',
                borderRadius: 8,
                fontWeight: 'bold',
                cursor: 'pointer',
                marginRight: 10
              }}
            >
              Increment
            </button>
            <button 
              onClick={() => setCount(0)}
              style={{
                backgroundColor: '#e2e8f0',
                color: '#2d3748',
                border: 'none',
                padding: '10px 20px',
                borderRadius: 8,
                fontWeight: 'bold',
                cursor: 'pointer'
              }}
            >
              Reset
            </button>
          </div>
    
          <div style={{ 
            backgroundColor: '#f7fafc', 
            padding: 20, 
            borderRadius: 12,
            marginTop: 20 
          }}>
            <h2 style={{ color: '#2d3748' }}>Input Demo</h2>
            <input
              type="text"
              value={text}
              onChange={(e) => setText(e.target.value)}
              placeholder="Type something..."
              style={{
                width: '100%',
                padding: '10px',
                borderRadius: 8,
                border: '2px solid #cbd5e0',
                fontSize: 16,
                boxSizing: 'border-box'
              }}
            />
            {text && (
              <p style={{ 
                marginTop: 10, 
                color: '#4a5568',
                fontSize: 18 
              }}>
                You typed: <strong>{text}</strong>
              </p>
            )}
          </div>
    
          <p style={{ 
            marginTop: 30, 
            color: '#718096',
            fontSize: 14 
          }}>
            Edit this code in the editor and click Run! ‚ú®
          </p>
        </div>
      );
    }`;
    
    let currentCode = defaultCode;
    let errorDecorations = [];
    
    /* ==================== FIXED MONACO EDITOR SETUP ==================== */
    require.config({
      paths: { vs: "https://unpkg.com/monaco-editor@0.45.0/min/vs" }
    });
    
    let editor;
    require(["vs/editor/editor.main"], () => {
      // FIX: Configure TypeScript to ignore unused variables and exports warnings
      monaco.languages.typescript.typescriptDefaults.setCompilerOptions({
        target: monaco.languages.typescript.ScriptTarget.Latest,
        allowNonTsExtensions: true,
        moduleResolution: monaco.languages.typescript.ModuleResolutionKind.NodeJs,
        module: monaco.languages.typescript.ModuleKind.ESNext,
        jsx: monaco.languages.typescript.JsxEmit.React,
        reactNamespace: "React",
        allowJs: true,
        esModuleInterop: true,
        skipLibCheck: true,
        
        // DISABLE these warnings:
        noUnusedLocals: false,      // Allow unused locals
        noUnusedParameters: false,  // Allow unused parameters  
        noImplicitReturns: false,   // Allow implicit returns
        noFallthroughCasesInSwitch: false,
        
        // Strict mode settings (set to false to avoid errors)
        strict: false,
        strictNullChecks: false,
        strictFunctionTypes: false,
        strictBindCallApply: false,
        strictPropertyInitialization: false,
        noImplicitAny: false,
        noImplicitThis: false,
        alwaysStrict: false,
        
        // Diagnostics settings
        diagnosticOptions: {
          noSemanticValidation: false,
          noSyntaxValidation: false,
          noSuggestionDiagnostics: true, // Hide suggestion diagnostics
        }
      });
    
      // Add diagnostic filtering to hide specific warnings
      monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({
        noSemanticValidation: false,
        noSyntaxValidation: false,
        diagnosticCodesToIgnore: [
          6133,  // 'App' is declared but its value is never read
          6138,  // Property 'X' is declared but never used
          6192,  // All imports are unused
          6196,  // 'React' is declared but its value is never read
          6198,  // All destructured elements are unused
          6199,  // All variables are unused
          6137
        ]
      });
    
      // Add simplified React type definitions (to avoid import issues)
      const reactTypes = `
    declare namespace React {
      // Hooks
      function useState<T>(initialState: T | (() => T)): [T, (value: T | ((prevState: T) => T)) => void];
      function useEffect(effect: () => void | (() => void), deps?: readonly any[]): void;
      function useRef<T>(initialValue: T): { current: T };
      function useContext<T>(context: any): T;
      function useReducer<R, I>(reducer: (state: R, action: any) => R, initializerArg: I, initializer?: (arg: I) => R): [R, (action: any) => void];
      function useCallback<T extends (...args: any[]) => any>(callback: T, deps: readonly any[]): T;
      function useMemo<T>(factory: () => T, deps: readonly any[]): T;
      
      // Component creation
      function createElement<P = {}>(
        type: string | ComponentType<P>,
        props?: P | null,
        ...children: ReactNode[]
      ): ReactElement<P>;
      
      // Types
      type ReactNode = string | number | boolean | ReactElement | null | undefined;
      
      interface ReactElement<P = any, T extends string | ComponentType<any> = string | ComponentType<any>> {
        type: T;
        props: P;
        key: string | null;
      }
      
      interface Component<P = {}, S = {}> {
        props: P;
        state: S;
      }
      
      interface FunctionComponent<P = {}> {
        (props: P): ReactElement | null;
      }
      
      interface ComponentClass<P = {}, S = {}> {
        new (props: P): Component<P, S>;
      }
      
      type ComponentType<P = {}> = FunctionComponent<P> | ComponentClass<P>;
      
      // Fragments
      const Fragment: ComponentType<{ children?: ReactNode }>;
    }
    
    // Global React object
    declare const React: typeof React;
    
    // Module declaration for import statements
    declare module "react" {
      export = React;
      export as namespace React;
    }`;
    
      monaco.languages.typescript.typescriptDefaults.addExtraLib(
        reactTypes,
        'file:///node_modules/@types/react/index.d.ts'
      );
    
      // Create custom theme
      monaco.editor.defineTheme('react-dark', {
        base: 'vs-dark',
        inherit: true,
        rules: [
          { token: 'comment', foreground: '6A9955', fontStyle: 'italic' },
          { token: 'keyword', foreground: '569CD6', fontStyle: 'bold' },
          { token: 'string', foreground: 'CE9178' },
          { token: 'number', foreground: 'B5CEA8' },
          { token: 'function', foreground: 'DCDCAA' },
          { token: 'type', foreground: '4EC9B0' },
          { token: 'jsx-tag', foreground: '4FC1FF' },
          { token: 'jsx-attribute', foreground: '9CDCFE' },
        ],
        colors: {
          'editor.background': '#0a0e27',
          'editor.foreground': '#e5e7eb',
          'editor.lineHighlightBackground': '#1a1d2e80',
          'editorCursor.foreground': '#61dafb',
          'editor.selectionBackground': '#61dafb40',
          'editor.lineHighlightBorder': '#61dafb20',
          'editorSuggestWidget.background': '#1a1d2e',
          'editorSuggestWidget.border': '#61dafb20',
          'editorSuggestWidget.selectedBackground': '#61dafb30',
        }
      });
    
      // Create editor
      editor = monaco.editor.create(document.getElementById("editor"), {
        value: currentCode,
        language: "typescript",
        theme: "react-dark",
        automaticLayout: true,
        minimap: { enabled: true },
        fontSize: 14,
        scrollBeyondLastLine: false,
        lineNumbers: "on",
        wordWrap: 'on',
        wrappingIndent: 'same',
        scrollbar: {
          vertical: 'visible',
          horizontal: 'visible'
        }
      });
    
      // Track changes
      editor.getModel().onDidChangeContent(() => {
        currentCode = editor.getValue();
        updateStatus("typing");
        clearErrors();
      });
    
      // Error checking (only for real errors, not warnings)
      let checkTimeout;
      editor.onDidChangeModelContent(() => {
        clearTimeout(checkTimeout);
        checkTimeout = setTimeout(checkRealErrors, 800);
      });
    });
    
    /* ==================== FIXED ERROR CHECKING ==================== */
    function checkRealErrors() {
      if (!editor) return;
      
      const model = editor.getModel();
      const markers = monaco.editor.getModelMarkers({ resource: model.uri });
      
      // Clear previous decorations
      errorDecorations = editor.deltaDecorations(errorDecorations, []);
      
      // Filter out "unused variable" warnings (code 6133, 6138, 6192, 6196)
      const realErrors = markers.filter(marker => {
        // Ignore these specific warning codes
        const ignoredCodes = [6133, 6138, 6192, 6196, 6198, 6199, 6137];
        return !ignoredCodes.includes(marker.code?.number || 0);
      });
      
      if (realErrors.length > 0) {
        const newDecorations = realErrors.map(marker => ({
          range: new monaco.Range(
            marker.startLineNumber,
            marker.startColumn,
            marker.endLineNumber,
            marker.endColumn
          ),
          options: {
            className: 'error-line',
            hoverMessage: { value: marker.message },
            glyphMarginClassName: 'error-glyph',
            overviewRuler: {
              color: '#ef4444',
              position: monaco.editor.OverviewRulerLane.Right
            }
          }
        }));
        
        errorDecorations = editor.deltaDecorations(errorDecorations, newDecorations);
        
        // Show first real error in console
        const firstError = realErrors[0];
        if (firstError) {
          consoleDiv.innerHTML = `<span class="console-line error">> ‚ùå TypeScript Error (Line ${firstError.startLineNumber}): ${firstError.message}</span>`;
          updateStatus("error");
        }
      } else {
        clearErrors();
        updateStatus("typing");
      }
    }
    
    function clearErrors() {
      if (editor) {
        errorDecorations = editor.deltaDecorations(errorDecorations, []);
      }
      document.getElementById("error").style.display = "none";
    }
    
    /* ==================== STATUS UPDATER ==================== */
    function updateStatus(status) {
      const indicator = document.getElementById("status-indicator");
      if (!indicator) return;
      
      switch(status) {
        case "ready":
          indicator.className = "status-item ready";
          indicator.innerHTML = '<span>‚óè Ready</span>';
          break;
        case "running":
          indicator.className = "status-item running";
          indicator.innerHTML = '<span>‚è≥ Running...</span>';
          break;
        case "error":
          indicator.className = "status-item error";
          indicator.innerHTML = '<span>‚óè Error</span>';
          break;
        case "typing":
          indicator.className = "status-item typing";
          indicator.innerHTML = '<span>‚óè Modified</span>';
          break;
      }
    }
    
    /* ==================== SIMPLIFIED COMPILATION ==================== */
    function compile() {
      if (typeof Babel === 'undefined') {
        throw new Error('Babel is not loaded. Please wait and try again.');
      }
    
      try {
        // Clean up the code - remove import statements since React is global
        let codeToCompile = currentCode;
        
        // Option 1: If user wants to keep imports, we'll transform them
        // Option 2: Remove imports and rely on global React
        
        // Simple approach: Just transpile JSX to JS
        const result = Babel.transform(codeToCompile, {
          presets: ['react'],
          filename: 'App.jsx'
        });
        
        if (!result.code) {
          throw new Error('Babel transformation failed');
        }
        
        // Create the preview HTML
        return createPreviewHTML(result.code);
        
      } catch (error) {
        throw new Error(`Compilation failed: ${error.message}`);
      }
    }
    
    /* ==================== CREATE PREVIEW HTML ==================== */
    function createPreviewHTML(appCode) {
      return `<!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <title>React Preview</title>
        <style>
            body { 
                margin: 0; 
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
                background: #f8fafc;
            }
            #root { 
                min-height: 100vh;
                padding: 20px;
            }
            * { 
                box-sizing: border-box;
            }
        </style>
    </head>
    <body>
        <div id="root">
            <div style="padding: 40px; text-align: center; color: #666;">
                Loading React app...
            </div>
        </div>
    
        <script>
            // Console redirection
            (function() {
                const originalLog = console.log;
                const originalError = console.error;
    
                console.log = (...args) => {
                    try {
                        parent.postMessage({ 
                            type: 'log', 
                            args: args.map(arg => typeof arg === 'object' ? JSON.stringify(arg) : String(arg))
                        }, '*');
                    } catch(e) {}
                    originalLog(...args);
                };
    
                console.error = (...args) => {
                    try {
                        parent.postMessage({ type: 'error', args: args.map(String) }, '*');
                    } catch(e) {}
                    originalError(...args);
                };
            })();
        <\/script>
    
        <!-- React & ReactDOM -->
        <script src="https://unpkg.com/react@18/umd/react.development.js"><\/script>
        <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"><\/script>
    
        <!-- Transpiled App Code -->
        <script>
            // Remove import statements since React is global
            const transpiledCode = \`${appCode.replace(/import\s+.*?from\s+['"][^'"]+['"];?\n?/g, '')}\`;
            
            // Execute the transpiled code
            try {
                eval(transpiledCode);
                
                // Find the App component (it should be exported as default)
                const AppComponent = window.App || (typeof App !== 'undefined' ? App : null);
                
                // Render the app
                const container = document.getElementById('root');
                if (container && AppComponent && window.React && window.ReactDOM) {
                    const root = window.ReactDOM.createRoot(container);
                    root.render(window.React.createElement(AppComponent));
                } else {
                    console.error('Failed to render: Missing components');
                }
            } catch (error) {
                console.error('Execution error:', error);
                document.getElementById('root').innerHTML = 
                    '<div style="color: #ef4444; padding: 20px;">Error: ' + error.message + '</div>';
            }
        <\/script>
    </body>
    </html>`;
    }
    
    /* ==================== RUN FUNCTION ==================== */
    const iframe = document.getElementById("preview");
    const consoleDiv = document.getElementById("console");
    const errorDiv = document.getElementById("error");
    
    function run() {
      updateStatus("running");
      errorDiv.style.display = "none";
      consoleDiv.innerHTML = '<span class="console-line info">> Running...</span>';
      
      try {
        // First check for real errors (not warnings)
        checkRealErrors();
        
        const compiledHtml = compile();
        
        // Update iframe
        const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
        iframeDoc.open();
        iframeDoc.write(compiledHtml);
        iframeDoc.close();
        
        setTimeout(() => {
          consoleDiv.innerHTML += '<span class="console-line log">> ‚úì Code executed successfully!</span>';
          updateStatus("ready");
        }, 400);
        
      } catch (err) {
        showError(err.message);
        updateStatus("error");
      }
    }
    
    /* ==================== CONSOLE & ERROR HANDLING ==================== */
    window.addEventListener("message", (e) => {
      if (!e.data || !e.data.type) return;
      
      const lineClass = e.data.type === 'error' ? 'error' : 'log';
      const prefix = e.data.type === 'error' ? '> ‚ùå' : '>';
      
      const line = document.createElement('div');
      line.className = `console-line ${lineClass}`;
      line.textContent = `${prefix} ${e.data.args?.join(' ') || 'Unknown message'}`;
      
      consoleDiv.appendChild(line);
      consoleDiv.scrollTop = consoleDiv.scrollHeight;
    });
    
    function showError(msg) {
      errorDiv.style.display = "block";
      errorDiv.textContent = "‚ùå " + msg;
      
      const errorLine = document.createElement('div');
      errorLine.className = 'console-line error';
      errorLine.textContent = `> ‚ùå ${msg}`;
      consoleDiv.appendChild(errorLine);
      consoleDiv.scrollTop = consoleDiv.scrollHeight;
    }
    
    function clearConsole() {
      consoleDiv.innerHTML = '<span class="console-line info">> Console cleared</span>';
      errorDiv.style.display = "none";
      updateStatus("ready");
    }
    
    /* ==================== SHARE FUNCTION ==================== */
    function share() {
      try {
        const encoded = btoa(encodeURIComponent(currentCode));
        const url = `${window.location.origin}${window.location.pathname}#${encoded}`;
        
        navigator.clipboard.writeText(url).then(() => {
          showNotification("üìã Link copied to clipboard!");
        }).catch(() => {
          prompt("Copy this URL to share:", url);
        });
        
      } catch (err) {
        alert("Could not generate share link: " + err.message);
      }
    }
    
    function showNotification(message) {
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: var(--accent-green);
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        box-shadow: var(--shadow-md);
        z-index: 1000;
        animation: slideIn 0.3s ease;
      `;
      notification.textContent = message;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.animation = 'slideIn 0.3s ease reverse';
        setTimeout(() => notification.remove(), 300);
      }, 2000);
    }
    
    /* ==================== RESET FUNCTION ==================== */
    function resetCode() {
      if (confirm("Reset to default code? Your changes will be lost.")) {
        editor.setValue(defaultCode);
        currentCode = defaultCode;
        clearErrors();
        updateStatus("ready");
        run();
      }
    }
    
    /* ==================== FORMAT CODE FUNCTION ==================== */
    function formatCode() {
      if (!editor) return;
      
      try {
        editor.getAction('editor.action.formatDocument').run();
        consoleDiv.innerHTML += '<span class="console-line log">> ‚úì Code formatted</span>';
        updateStatus("ready");
      } catch (err) {
        consoleDiv.innerHTML += '<span class="console-line warn">> ‚ö†Ô∏è Formatting not available</span>';
      }
    }
    
    /* ==================== LOAD FROM URL ==================== */
    window.addEventListener("load", () => {
      updateStatus("running");
      
      const initInterval = setInterval(() => {
        if (typeof monaco !== 'undefined' && typeof Babel !== 'undefined') {
          clearInterval(initInterval);
          
          // Load from URL
          if (location.hash && location.hash.length > 1) {
            try {
              const decoded = decodeURIComponent(atob(location.hash.slice(1)));
              if (decoded && decoded.trim().length > 10) {
                if (editor) {
                  editor.setValue(decoded);
                  currentCode = decoded;
                }
                consoleDiv.innerHTML = '<span class="console-line info">> Loaded code from URL</span>';
              }
            } catch (err) {
              consoleDiv.innerHTML = '<span class="console-line warn">> Could not load code from URL</span>';
            }
          }
          
          // Run initial code after a short delay
          setTimeout(() => {
            if (editor) {
              run();
            }
            updateStatus("ready");
          }, 500);
        }
      }, 100);
    });
    </script>
</body>
</html>

